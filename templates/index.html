<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Semsar Mate - Hotel Search</title>
    
    <!-- External CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    
    <!-- Custom CSS -->
    <style>
        /* Variables */
        :root {
            --navy: #0A2463;
            --gold: #D4AF37;
            --white: #FFFFFF;
            --light-gold: #E5C76B;
            --navy-light: #1A3B7D;
        }

        /* Base Styles */
        body {
            background-color: var(--navy);
            color: var(--white);
            padding: 20px;
        }

        /* Layout Components */
        .search-container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--white);
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        /* Hotel Cards */
        .hotel-card {
            margin-bottom: 20px;
            transition: transform 0.2s;
            height: 100%;
            border: 1px solid var(--navy);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            background-color: var(--white);
        }

        .hotel-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .hotel-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-top-left-radius: 0.25rem;
            border-top-right-radius: 0.25rem;
        }

        /* Card Content */
        .card-body {
            padding: 1.25rem;
        }

        .card-title {
            font-size: 1.25rem;
            margin-bottom: 1rem;
            color: var(--navy);
            font-weight: bold;
        }

        .price-tag {
            color: var(--gold);
            font-weight: bold;
            font-size: 1.1rem;
        }

        .rating {
            color: var(--gold);
            font-weight: bold;
        }

        .hotel-description {
            color: var(--navy);
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        .hotel-address {
            color: var(--navy);
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        /* Popular Cities Section */
        .popular-cities {
            margin: 20px 0;
            text-align: center;
            position: relative;
            padding: 0 40px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .popular-cities-container {
            display: flex;
            overflow-x: hidden;
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            -ms-overflow-style: none;
            padding: 10px 0;
            justify-content: flex-start;
            gap: 10px;
            width: 100%;
        }

        .popular-cities-container::-webkit-scrollbar {
            display: none;
        }

        .popular-cities .btn {
            margin: 0;
            white-space: nowrap;
            flex: 0 0 auto;
            min-width: 120px;
        }

        /* Scroll Buttons */
        .scroll-button {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: var(--gold);
            color: var(--navy);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            z-index: 1;
            font-size: 20px;
            transition: background-color 0.2s;
        }

        .scroll-button:hover {
            background-color: var(--light-gold);
        }

        .scroll-button:active {
            transform: translateY(-50%) scale(0.95);
        }

        .scroll-left { left: 0; }
        .scroll-right { right: 0; }

        /* Section Titles */
        .section-title {
            margin: 30px 0 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--gold);
            color: var(--navy);
        }

        /* Modal Styles */
        .hotel-modal .modal-content {
            border-radius: 15px;
            background-color: var(--white);
        }

        .hotel-modal .modal-header {
            background-color: var(--navy);
            color: var(--white);
            border-bottom: 2px solid var(--gold);
        }

        .hotel-modal .modal-title {
            color: var(--gold);
            font-weight: bold;
        }

        /* Hotel Details Modal */
        .hotel-details {
            padding: 20px;
            color: var(--navy);
        }

        .hotel-info-section {
            margin-bottom: 20px;
            padding: 15px;
            background-color: var(--white);
            border-radius: 10px;
            border: 1px solid var(--navy);
        }

        .hotel-info-section h5 {
            color: var(--navy);
            margin-bottom: 15px;
            border-bottom: 1px solid var(--gold);
            padding-bottom: 10px;
        }

        /* Amenities Grid */
        .amenities-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .amenity-item {
            display: flex;
            align-items: center;
            padding: 8px;
            background-color: var(--white);
            border: 1px solid var(--navy);
            border-radius: 5px;
            color: var(--navy);
        }

        .amenity-item i {
            margin-right: 8px;
            color: var(--gold);
        }

        /* Auth Modal Styles */
        .auth-modal .modal-content {
            border-radius: 15px;
            border: none;
        }

        .auth-modal .modal-header {
            background-color: var(--navy);
            color: var(--white);
            border-bottom: none;
            border-radius: 15px 15px 0 0;
        }

        .auth-modal .modal-body {
            padding: 30px;
        }

        .auth-modal .form-control {
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 15px;
        }

        /* Navbar Styles */
        .navbar {
            background-color: var(--navy);
            padding: 1rem 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .navbar-brand {
            color: var(--gold) !important;
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .nav-link {
            color: var(--white) !important;
            margin: 0 10px;
            transition: color 0.3s ease;
        }
        
        .nav-link:hover {
            color: var(--gold) !important;
        }
        
        /* User Welcome Section */
        .user-welcome {
            display: flex;
            align-items: center;
            gap: 1rem;
            color: var(--gold);
            font-size: 1.1rem;
        }
        
        .user-welcome span {
            font-weight: 600;
            color: var(--white);
        }
        
        /* Notification Styles */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 5px;
            color: white;
            font-weight: bold;
            z-index: 1000;
            animation: slideIn 0.5s ease-out;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .notification.success { background-color: #28a745; }
        .notification.error { background-color: #dc3545; }
        .notification.info { background-color: #17a2b8; }

        /* Animations */
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        /* View Details Button */
        .view-details-btn {
            background-color: var(--gold);
            color: var(--navy);
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            font-weight: 600;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .view-details-btn:hover {
            background-color: var(--light-gold);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .view-details-btn:active {
            transform: translateY(0);
        }

        .view-details-btn i {
            font-size: 1.1rem;
        }

        /* Booking Form Styles */
        .booking-form {
            padding: 20px;
            background-color: var(--white);
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            height: calc(100vh - 100px);
            overflow-y: auto;
            margin: 0 auto;
        }

        .modal-dialog {
            max-width: 600px;
            margin: 1.75rem auto;
            height: calc(100vh - 3.5rem);
        }

        .modal-content {
            height: 100%;
            border-radius: 15px;
            border: none;
        }

        .modal-header {
            padding: 1rem;
            background-color: var(--navy);
            border-bottom: 2px solid var(--gold);
            border-top-left-radius: 15px;
            border-top-right-radius: 15px;
        }

        .modal-body {
            padding: 0;
            overflow-y: auto;
            height: calc(100% - 60px);
        }

        .booking-form .form-label {
            color: var(--navy);
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .booking-form .form-control,
        .booking-form .form-select {
            border: 2px solid var(--navy-light);
            border-radius: 8px;
            padding: 12px 15px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background-color: var(--white);
            width: 100%;
        }

        .booking-form .form-control:focus,
        .booking-form .form-select:focus {
            border-color: var(--gold);
            box-shadow: 0 0 0 0.2rem rgba(212, 175, 55, 0.25);
        }

        .booking-form .form-control::placeholder {
            color: #6c757d;
            opacity: 0.7;
        }

        .booking-form .btn-primary {
            background-color: var(--gold);
            color: var(--navy);
            border: none;
            padding: 14px 28px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 25px;
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: sticky;
            bottom: 20px;
        }

        .booking-form .btn-primary:hover {
            background-color: var(--light-gold);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(212, 175, 55, 0.3);
        }

        .booking-form .btn-primary:active {
            transform: translateY(0);
        }

        .booking-summary {
            background-color: var(--navy-light);
            color: var(--white);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .booking-summary h6 {
            color: var(--gold);
            margin-bottom: 15px;
            font-size: 1.1rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .booking-summary p {
            margin-bottom: 8px;
            font-size: 0.95rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .booking-summary p strong {
            color: var(--gold);
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 20px;
            position: relative;
            padding: 0 20px;
        }

        .form-group i {
            position: absolute;
            right: 35px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--navy-light);
            pointer-events: none;
        }

        .form-group textarea + i {
            top: 25px;
            transform: none;
        }

        @media (max-width: 768px) {
            .modal-dialog {
                margin: 0;
                max-width: 100%;
                height: 100vh;
            }

            .modal-content {
                border-radius: 0;
            }

            .modal-header {
                border-radius: 0;
            }

            .booking-form {
                padding: 15px;
                max-width: 100%;
                height: calc(100vh - 60px);
            }

            .form-group {
                padding: 0 15px;
            }

            .form-group i {
                right: 30px;
            }

            .booking-form .btn-primary {
                margin: 20px 15px;
                width: calc(100% - 30px);
            }
        }

        /* My Bookings Styles */
        .bookings-container {
            padding: 20px;
        }

        .booking-card {
            background: var(--white);
            border: 1px solid var(--navy-light);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }

        .booking-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .booking-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--navy-light);
        }

        .booking-ref {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--navy);
        }

        .booking-status {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .status-upcoming {
            background-color: #e3f2fd;
            color: #1976d2;
        }

        .status-past {
            background-color: #f5f5f5;
            color: #616161;
        }

        .status-cancelled {
            background-color: #ffebee;
            color: #d32f2f;
        }

        .booking-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .booking-info {
            display: flex;
            flex-direction: column;
        }

        .booking-info-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
        }

        .booking-info-value {
            font-weight: 500;
            color: var(--navy);
        }

        .booking-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .booking-actions button {
            padding: 8px 15px;
            border-radius: 5px;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .btn-cancel {
            background-color: #ffebee;
            color: #d32f2f;
            border: 1px solid #d32f2f;
        }

        .btn-cancel:hover {
            background-color: #d32f2f;
            color: white;
        }

        .btn-view {
            background-color: var(--navy-light);
            color: white;
            border: none;
        }

        .btn-view:hover {
            background-color: var(--navy);
        }

        .no-bookings {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .no-bookings i {
            font-size: 3rem;
            color: #ddd;
            margin-bottom: 15px;
        }

        /* Voice Agent Styles */
        .voice-agent-container {
            position: fixed;
            bottom: 20px;
            left: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1000;
        }

        .voice-agent-btn {
            width: 60px;
            height: 60px;
            background-color: var(--gold);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            border: none;
        }

        .voice-agent-btn:hover {
            transform: scale(1.1);
            background-color: var(--light-gold);
        }

        .voice-agent-btn.active {
            background-color: #dc3545;
            animation: pulse 1.5s infinite;
        }

        .voice-agent-btn i {
            color: var(--navy);
            font-size: 24px;
        }

        .voice-agent-input {
            display: none;
            background: white;
            border-radius: 25px;
            padding: 5px 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }

        .voice-agent-input.active {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .voice-agent-input input {
            border: none;
            outline: none;
            background: transparent;
            width: 200px;
            font-size: 14px;
            color: var(--navy);
        }

        .voice-agent-input input::placeholder {
            color: #999;
        }

        .send-command-btn {
            background: none;
            border: none;
            color: var(--gold);
            cursor: pointer;
            padding: 5px;
            transition: all 0.3s ease;
        }

        .send-command-btn:hover {
            color: var(--light-gold);
            transform: scale(1.1);
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.4);
            }
            70% {
                transform: scale(1.1);
                box-shadow: 0 0 0 10px rgba(220, 53, 69, 0);
            }
            100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(220, 53, 69, 0);
            }
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand" href="/index">
                <i class="fas fa-hotel me-2"></i>Semsar Mate
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" title="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/index">
                            <i class="fas fa-home me-1"></i>Home
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/blog">
                            <i class="fas fa-blog me-1"></i>Blog
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/assistant">
                            <i class="fas fa-robot me-1"></i>Semsar Assistant
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showMyBookings()">
                            <i class="fas fa-calendar-check me-1"></i>My Bookings
                        </a>
                    </li>
                </ul>
                <div class="d-flex align-items-center">
                    <div class="user-welcome">
                        <i class="fas fa-user-circle me-1"></i>Welcome,<span id="userName"> Guest</span>
                    </div>
                    <a href="/signout" class="nav-link">
                        <i class="fas fa-sign-out-alt me-1"></i>Logout
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container">
        <div class="search-container">
            <h1 class="text-center mb-4">Hotel Search</h1>
            
            <!-- Search Form -->
            <form id="searchForm" class="mb-4">
                <div class="input-group">
                    <input type="text" id="cityInput" class="form-control" placeholder="Enter city name..." required>
                    <button type="submit" class="btn btn-primary">Search</button>
                </div>
            </form>

            <!-- Popular Cities -->
            <div class="popular-cities">
                <h3 class="section-title">Popular Cities</h3>
                <button class="scroll-button scroll-left" onclick="scrollCities('left')" title="Scroll left">
                    &#10094;
                </button>
                <div class="popular-cities-container">
                    <!-- Moroccan Cities -->
                    <button class="btn btn-outline-primary" onclick="searchCity('Casablanca')">Casablanca</button>
                    <button class="btn btn-outline-primary" onclick="searchCity('Rabat')">Rabat</button>
                    <button class="btn btn-outline-primary" onclick="searchCity('Agadir')">Agadir</button>
                    <button class="btn btn-outline-primary" onclick="searchCity('Marrakech')">Marrakech</button>
                    <button class="btn btn-outline-primary" onclick="searchCity('Tangier')">Tangier</button>
                    <button class="btn btn-outline-primary" onclick="searchCity('Fes')">Fes</button>
                    <button class="btn btn-outline-primary" onclick="searchCity('Essaouira')">Essaouira</button>
                    <!-- International Cities -->
                    <button class="btn btn-outline-primary" onclick="searchCity('Paris')">Paris</button>
                    <button class="btn btn-outline-primary" onclick="searchCity('London')">London</button>
                    <button class="btn btn-outline-primary" onclick="searchCity('New York')">New York</button>
                    <button class="btn btn-outline-primary" onclick="searchCity('Tokyo')">Tokyo</button>
                    <button class="btn btn-outline-primary" onclick="searchCity('Dubai')">Dubai</button>
                    <button class="btn btn-outline-primary" onclick="searchCity('Rome')">Rome</button>
                    <button class="btn btn-outline-primary" onclick="searchCity('Barcelona')">Barcelona</button>
                    <button class="btn btn-outline-primary" onclick="searchCity('Amsterdam')">Amsterdam</button>
                </div>
                <button class="scroll-button scroll-right" onclick="scrollCities('right')" title="Scroll right">
                    &#10095;
                </button>
            </div>
            
            <!-- Loading Indicator -->
            <div class="loading">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-2">Searching for hotels...</p>
            </div>

            <!-- Results Section -->
            <div id="results">
                <h3 class="section-title">Featured Hotels</h3>
                <div class="row" id="featuredHotels">
                    <!-- Featured hotels will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Hotel Details Modal -->
    <div class="modal fade hotel-modal" id="hotelDetailsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Hotel Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body hotel-details">
                    <div class="hotel-info-section">
                        <h5>Basic Information</h5>
                        <div id="modalHotelName" class="h4 mb-3"></div>
                        <div id="modalHotelPrice" class="price-tag mb-2"></div>
                        <div id="modalHotelRating" class="rating mb-2"></div>
                        <div id="modalHotelAddress" class="hotel-address"></div>
                    </div>
                    
                    <div class="hotel-info-section">
                        <h5>Description</h5>
                        <p id="modalHotelDescription" class="hotel-description"></p>
                    </div>
                    
                    <div class="hotel-info-section">
                        <h5>Amenities</h5>
                        <div class="amenities-grid" id="modalHotelAmenities"></div>
                    </div>
                    
                    <div class="hotel-info-section">
                        <h5>Location</h5>
                        <div id="modalHotelLocation" class="hotel-address"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="bookHotel()">Book Now</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Booking Modal -->
    <div class="modal fade" id="bookingModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Book Your Stay</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" title="Close modal"></button>
                </div>
                <div class="modal-body">
                    <form id="bookingForm" class="booking-form">
                        <div class="booking-summary">
                            <h6>Booking Summary</h6>
                            <p>
                                <strong>Hotel:</strong>
                                <span id="bookingHotelName"></span>
                            </p>
                            <p>
                                <strong>Base Price:</strong>
                                <span id="bookingBasePrice"></span>
                            </p>
                        </div>
                        
                        <div class="form-group">
                            <label for="checkIn" class="form-label">Check-in Date</label>
                            <input type="date" class="form-control" id="checkIn" required>
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                        
                        <div class="form-group">
                            <label for="checkOut" class="form-label">Check-out Date</label>
                            <input type="date" class="form-control" id="checkOut" required>
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                        
                        <div class="form-group">
                            <label for="guests" class="form-label">Number of Guests</label>
                            <select class="form-select" id="guests" required>
                                <option value="">Select number of guests</option>
                                <option value="1">1 Guest</option>
                                <option value="2">2 Guests</option>
                                <option value="3">3 Guests</option>
                                <option value="4">4 Guests</option>
                            </select>
                            <i class="fas fa-users"></i>
                        </div>
                        
                        <div class="form-group">
                            <label for="roomType" class="form-label">Room Type</label>
                            <select class="form-select" id="roomType" required>
                                <option value="">Select Room Type</option>
                                <option value="Standard">Standard Room</option>
                                <option value="Deluxe">Deluxe Room</option>
                                <option value="Suite">Suite</option>
                            </select>
                            <i class="fas fa-bed"></i>
                        </div>
                        
                        <div class="form-group">
                            <label for="specialRequests" class="form-label">Special Requests</label>
                            <textarea class="form-control" id="specialRequests" rows="3" placeholder="Any special requests or requirements?"></textarea>
                            <i class="fas fa-comment-alt"></i>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-check-circle me-2"></i>Confirm Booking
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- My Bookings Modal -->
    <div class="modal fade" id="myBookingsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">My Bookings</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" title="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="bookings-container">
                        <div class="bookings-filters mb-4">
                            <div class="row">
                                <div class="col-md-4">
                                    <select class="form-select" id="bookingStatusFilter" title="Filter bookings by status">
                                        <option value="all">All Bookings</option>
                                        <option value="upcoming">Upcoming</option>
                                        <option value="past">Past</option>
                                        <option value="cancelled">Cancelled</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <input type="text" class="form-control" id="bookingSearch" placeholder="Search bookings...">
                                </div>
                                <div class="col-md-4">
                                    <button class="btn btn-primary w-100" onclick="refreshBookings()">
                                        <i class="fas fa-sync-alt me-2"></i>Refresh
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div id="bookingsList" class="bookings-list">
                            <!-- Bookings will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Voice Agent Button and Input -->
    <div class="voice-agent-container">
        <div class="voice-agent-btn" id="voiceAgentBtn" title="Voice Assistant">
            <i class="fas fa-microphone"></i>
        </div>
        <div class="voice-agent-input" id="voiceAgentInput">
            <input type="text" placeholder="Type your command..." id="commandInput">
            <button class="send-command-btn" id="sendCommandBtn">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <!-- External Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Custom Scripts -->
    <script>
        // User Authentication
        function updateUserName() {
            fetch('/get-user-info')
                .then(response => {
                    if (!response.ok) throw new Error('Not logged in');
                    return response.json();
                })
                .then(data => {
                    if (data.name) {
                        document.getElementById('userName').textContent = data.name;
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    window.location.href = '/signin';
                });
        }

        // City Navigation
        function scrollCities(direction) {
            const container = document.querySelector('.popular-cities-container');
            const scrollAmount = 300;
            const currentScroll = container.scrollLeft;
            const maxScroll = container.scrollWidth - container.clientWidth;
            
            const newScroll = direction === 'left' 
                ? Math.max(0, currentScroll - scrollAmount)
                : Math.min(maxScroll, currentScroll + scrollAmount);
            
            container.scrollTo({
                left: newScroll,
                behavior: 'smooth'
            });
            
            const button = direction === 'left' 
                ? document.querySelector('.scroll-left') 
                : document.querySelector('.scroll-right');
            
            button.style.backgroundColor = '#D4AF37';
            setTimeout(() => button.style.backgroundColor = '#0A2463', 200);
        }

        function updateScrollButtons() {
            const container = document.querySelector('.popular-cities-container');
            const leftButton = document.querySelector('.scroll-left');
            const rightButton = document.querySelector('.scroll-right');
            
            leftButton.style.display = container.scrollLeft > 0 ? 'flex' : 'none';
            rightButton.style.display = 
                container.scrollLeft < (container.scrollWidth - container.clientWidth) ? 'flex' : 'none';
        }

        // Hotel Search
        function searchCity(city) {
            document.getElementById('cityInput').value = city;
            document.getElementById('searchForm').dispatchEvent(new Event('submit'));
        }

        function searchHotels(city) {
            const loading = document.querySelector('.loading');
            const results = document.getElementById('results');
            
            loading.style.display = 'block';
            results.innerHTML = '<h3 class="section-title">Search Results</h3><div class="row" id="hotelResults"></div>';
            
            fetch('/search', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: `city=${encodeURIComponent(city)}`
            })
            .then(response => response.json())
            .then(data => {
                loading.style.display = 'none';
                const hotelResults = document.getElementById('hotelResults');
                
                if (data.error) {
                    hotelResults.innerHTML = `<div class="col-12"><div class="alert alert-warning">${data.error}</div></div>`;
                    return;
                }
                
                if (data.hotels?.length > 0) {
                    hotelResults.innerHTML = data.hotels.map(hotel => `
                        <div class="col-md-6 col-lg-4 mb-4">
                            <div class="card hotel-card">
                                <div class="card-body">
                                    <h5 class="card-title">${hotel.name}</h5>
                                    ${hotel.price ? `<p class="price-tag">${hotel.price}$</p>` : ''}
                                    ${hotel.rating ? `<p class="rating">Rating: ${hotel.rating}/10</p>` : ''}
                                    ${hotel.address ? `<p class="hotel-address">${hotel.address}</p>` : ''}
                                    ${hotel.description ? `<p class="hotel-description">${hotel.description.substring(0, 100)}...</p>` : ''}
                                    <button class="view-details-btn" onclick='showHotelDetails(${JSON.stringify(hotel)})'>
                                        <i class="fas fa-info-circle"></i>View Details
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('');
                } else {
                    hotelResults.innerHTML = '<div class="col-12"><div class="alert alert-warning">No hotels found for this city.</div></div>';
                }
            })
            .catch(error => {
                loading.style.display = 'none';
                results.innerHTML = '<div class="alert alert-danger">An error occurred while searching for hotels. Please try again.</div>';
                console.error('Error:', error);
            });
        }

        // Hotel Details
        function showHotelDetails(hotel) {
            const modal = new bootstrap.Modal(document.getElementById('hotelDetailsModal'));
            
            document.getElementById('modalHotelName').textContent = hotel.name;
            document.getElementById('modalHotelPrice').textContent = hotel.price ? `${hotel.price}$` : 'Price not available';
            document.getElementById('modalHotelRating').textContent = hotel.rating ? `Rating: ${hotel.rating}/10` : 'No rating available';
            document.getElementById('modalHotelAddress').textContent = hotel.address || 'Address not available';
            document.getElementById('modalHotelDescription').textContent = hotel.description || 'No description available';
            document.getElementById('modalHotelLocation').textContent = hotel.address || 'Location not available';
            
            const amenities = [
                { icon: 'wifi', name: 'Free WiFi' },
                { icon: 'swimming-pool', name: 'Swimming Pool' },
                { icon: 'utensils', name: 'Restaurant' },
                { icon: 'parking', name: 'Free Parking' },
                { icon: 'concierge-bell', name: '24/7 Front Desk' },
                { icon: 'bed', name: 'Room Service' }
            ];
            
            document.getElementById('modalHotelAmenities').innerHTML = amenities.map(amenity => `
                <div class="amenity-item">
                    <i class="fas fa-${amenity.icon}"></i>
                    <span>${amenity.name}</span>
                </div>
            `).join('');
            
            modal.show();
        }

        // Booking System
        function bookHotel() {
            const hotelName = document.getElementById('modalHotelName').textContent;
            const hotelPrice = document.getElementById('modalHotelPrice').textContent;
            
            document.getElementById('bookingHotelName').textContent = hotelName;
            document.getElementById('bookingBasePrice').textContent = hotelPrice;
            
            const hotelDetailsModal = bootstrap.Modal.getInstance(document.getElementById('hotelDetailsModal'));
            hotelDetailsModal.hide();
            
            const bookingModal = new bootstrap.Modal(document.getElementById('bookingModal'));
            bookingModal.show();
        }

        // Store bookings in localStorage
        function storeBooking(bookingData) {
            let bookings = JSON.parse(localStorage.getItem('bookings') || '[]');
            bookings.push(bookingData);
            localStorage.setItem('bookings', JSON.stringify(bookings));
        }

        // Load bookings from localStorage
        function loadBookings() {
            const bookings = JSON.parse(localStorage.getItem('bookings') || '[]');
            const bookingsList = document.getElementById('bookingsList');
            const statusFilter = document.getElementById('bookingStatusFilter').value;
            const searchTerm = document.getElementById('bookingSearch').value.toLowerCase();
            
            // Filter bookings based on status and search term
            let filteredBookings = bookings;
            
            if (statusFilter !== 'all') {
                filteredBookings = filteredBookings.filter(booking => getBookingStatus(booking) === statusFilter);
            }
            
            if (searchTerm) {
                filteredBookings = filteredBookings.filter(booking => 
                    booking.hotelName.toLowerCase().includes(searchTerm) ||
                    booking.ref.toLowerCase().includes(searchTerm) ||
                    booking.roomType.toLowerCase().includes(searchTerm)
                );
            }
            
            if (filteredBookings.length === 0) {
                bookingsList.innerHTML = `
                    <div class="no-bookings">
                        <i class="fas fa-calendar-times"></i>
                        <h4>No Bookings Found</h4>
                        <p>${searchTerm ? `No bookings found matching "${searchTerm}"` : 'You haven\'t made any bookings yet.'}</p>
                    </div>
                `;
                return;
            }

            // Sort bookings by check-in date
            filteredBookings.sort((a, b) => new Date(a.checkIn) - new Date(b.checkIn));

            bookingsList.innerHTML = filteredBookings.map(booking => {
                const status = getBookingStatus(booking);
                return `
                    <div class="booking-card">
                        <div class="booking-header">
                            <span class="booking-ref">Booking #${booking.ref}</span>
                            <span class="booking-status status-${status}">
                                ${status.charAt(0).toUpperCase() + status.slice(1)}
                            </span>
                        </div>
                        <div class="booking-details">
                            <div class="booking-info">
                                <span class="booking-info-label">Hotel</span>
                                <span class="booking-info-value">${booking.hotelName}</span>
                            </div>
                            <div class="booking-info">
                                <span class="booking-info-label">Check-in</span>
                                <span class="booking-info-value">${booking.checkIn}</span>
                            </div>
                            <div class="booking-info">
                                <span class="booking-info-label">Check-out</span>
                                <span class="booking-info-value">${booking.checkOut}</span>
                            </div>
                            <div class="booking-info">
                                <span class="booking-info-label">Guests</span>
                                <span class="booking-info-value">${booking.guests}</span>
                            </div>
                            <div class="booking-info">
                                <span class="booking-info-label">Room Type</span>
                                <span class="booking-info-value">${booking.roomType}</span>
                            </div>
                            <div class="booking-info">
                                <span class="booking-info-label">Total Price</span>
                                <span class="booking-info-value">${booking.totalPrice}</span>
                            </div>
                        </div>
                        <div class="booking-actions">
                            <button class="btn btn-view" onclick="viewBookingDetails('${booking.ref}')" title="View booking details">
                                <i class="fas fa-eye me-2"></i>View Details
                            </button>
                            ${status === 'upcoming' ? `
                                <button class="btn btn-cancel" onclick="cancelBooking('${booking.ref}')" title="Cancel booking">
                                    <i class="fas fa-times me-2"></i>Cancel Booking
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getBookingStatus(booking) {
            const today = new Date();
            const checkIn = new Date(booking.checkIn);
            const checkOut = new Date(booking.checkOut);

            if (booking.status === 'cancelled') return 'cancelled';
            if (checkOut < today) return 'past';
            if (checkIn > today) return 'upcoming';
            return 'current';
        }

        function cancelBooking(bookingRef) {
            if (confirm('Are you sure you want to cancel this booking?')) {
                let bookings = JSON.parse(localStorage.getItem('bookings') || '[]');
                bookings = bookings.map(booking => {
                    if (booking.ref === bookingRef) {
                        return { ...booking, status: 'cancelled' };
                    }
                    return booking;
                });
                localStorage.setItem('bookings', JSON.stringify(bookings));
                showNotification('Booking cancelled successfully', 'success');
                loadBookings();
            }
        }

        // Update the booking form submission handler
        document.getElementById('bookingForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const bookingData = {
                ref: 'BK' + Math.random().toString(36).substring(2, 8).toUpperCase(),
                hotelName: document.getElementById('bookingHotelName').textContent,
                checkIn: document.getElementById('checkIn').value,
                checkOut: document.getElementById('checkOut').value,
                guests: document.getElementById('guests').value,
                roomType: document.getElementById('roomType').value,
                specialRequests: document.getElementById('specialRequests').value,
                totalPrice: document.getElementById('bookingBasePrice').textContent,
                status: 'upcoming',
                createdAt: new Date().toISOString()
            };
            
            // Store booking in localStorage
            let bookings = JSON.parse(localStorage.getItem('bookings') || '[]');
            bookings.push(bookingData);
            localStorage.setItem('bookings', JSON.stringify(bookings));
            
            const bookingModal = bootstrap.Modal.getInstance(document.getElementById('bookingModal'));
            bookingModal.hide();
            
            showNotification(`Booking confirmed! Your booking reference is: ${bookingData.ref}`, 'success');
            this.reset();
        });

        // Add filter functionality
        document.getElementById('bookingStatusFilter').addEventListener('change', function() {
            const status = this.value;
            const bookings = JSON.parse(localStorage.getItem('bookings') || '[]');
            
            if (status === 'all') {
                loadBookings();
                return;
            }
            
            const filteredBookings = bookings.filter(booking => getBookingStatus(booking) === status);
            const bookingsList = document.getElementById('bookingsList');
            
            if (filteredBookings.length === 0) {
                bookingsList.innerHTML = `
                    <div class="no-bookings">
                        <i class="fas fa-calendar-times"></i>
                        <h4>No ${status} Bookings</h4>
                        <p>You don't have any ${status} bookings.</p>
                    </div>
                `;
                return;
            }
            
            // Update the display with filtered bookings
            loadBookings(); // This will now use the filtered status
        });

        // Add search functionality
        document.getElementById('bookingSearch').addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const bookings = JSON.parse(localStorage.getItem('bookings') || '[]');
            
            const filteredBookings = bookings.filter(booking => 
                booking.hotelName.toLowerCase().includes(searchTerm) ||
                booking.ref.toLowerCase().includes(searchTerm) ||
                booking.roomType.toLowerCase().includes(searchTerm)
            );
            
            const bookingsList = document.getElementById('bookingsList');
            
            if (filteredBookings.length === 0) {
                bookingsList.innerHTML = `
                    <div class="no-bookings">
                        <i class="fas fa-search"></i>
                        <h4>No Matching Bookings</h4>
                        <p>No bookings found matching "${searchTerm}"</p>
                    </div>
                `;
                return;
            }
            
            // Update the display with filtered bookings
            loadBookings(); // This will now use the filtered results
        });

        // Notifications
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 5000);
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', () => {
            updateUserName();
            resetScrollPosition();
            searchCity('Casablanca');
        });

        document.getElementById('searchForm').addEventListener('submit', function(e) {
            e.preventDefault();
            searchHotels(document.getElementById('cityInput').value);
        });

        document.querySelector('.popular-cities-container').addEventListener('scroll', updateScrollButtons);

        // My Bookings Functions
        function showMyBookings() {
            const modal = new bootstrap.Modal(document.getElementById('myBookingsModal'));
            loadBookings();
            modal.show();
        }

        function refreshBookings() {
            loadBookings();
            showNotification('Bookings refreshed', 'info');
        }

        function viewBookingDetails(bookingRef) {
            // Implement booking details view
            console.log('Viewing booking:', bookingRef);
        }

        // Voice Agent Functionality
        const voiceAgentBtn = document.getElementById('voiceAgentBtn');
        const voiceAgentInput = document.getElementById('voiceAgentInput');
        const commandInput = document.getElementById('commandInput');
        const sendCommandBtn = document.getElementById('sendCommandBtn');

        let isAgentListening = false;
        let agentRecognition = null;

        function initAgentRecognition() {
            if ('webkitSpeechRecognition' in window) {
                agentRecognition = new webkitSpeechRecognition();
                agentRecognition.continuous = true;
                agentRecognition.interimResults = false;
                agentRecognition.lang = 'en-US';

                agentRecognition.onstart = () => {
                    isAgentListening = true;
                    voiceAgentBtn.classList.add('active');
                    voiceAgentInput.classList.add('active');
                };

                agentRecognition.onend = () => {
                    if (isAgentListening) {
                        // Restart recognition if it was supposed to be listening
                        setTimeout(() => {
                            if (isAgentListening) {
                                agentRecognition.start();
                            }
                        }, 100);
                    }
                };

                agentRecognition.onresult = (event) => {
                    const command = event.results[event.results.length - 1][0].transcript.toLowerCase();
                    commandInput.value = command;
                    handleAgentCommand(command);
                };

                agentRecognition.onerror = (event) => {
                    console.error('Agent recognition error:', event.error);
                };
            }
        }

        function startAgentListening() {
            if (agentRecognition && !isAgentListening) {
                isAgentListening = true;
                voiceAgentBtn.classList.add('active');
                voiceAgentInput.classList.add('active');
                agentRecognition.start();
                speakResponse('Voice agent activated. How can I help you?');
            }
        }

        function stopAgentListening() {
            if (agentRecognition && isAgentListening) {
                isAgentListening = false;
                voiceAgentBtn.classList.remove('active');
                voiceAgentInput.classList.remove('active');
                agentRecognition.stop();
                speakResponse('Voice agent deactivated');
                localStorage.removeItem('agentActive');
            }
        }

        function handleAgentCommand(command) {
            command = command.toLowerCase();

            // Scrolling commands
            if (command.includes('scroll up')) {
                window.scrollBy(0, -300);
                speakResponse('Scrolling up');
            } else if (command.includes('scroll down')) {
                window.scrollBy(0, 300);
                speakResponse('Scrolling down');
            } else if (command.includes('scroll to top')) {
                window.scrollTo(0, 0);
                speakResponse('Scrolling to top');
            } else if (command.includes('scroll to bottom')) {
                window.scrollTo(0, document.body.scrollHeight);
                speakResponse('Scrolling to bottom');
            }
            // Navigation commands
            else if (command.includes('go to assistant')) {
                localStorage.setItem('agentActive', 'true');
                window.location.href = '/assistant';
                speakResponse('Navigating to assistant');
            } else if (command.includes('go to blog')) {
                localStorage.setItem('agentActive', 'true');
                window.location.href = '/blog';
                speakResponse('Navigating to blog');
            }
            // Search commands
            else if (command.includes('search for')) {
                const city = command.replace('search for', '').trim();
                if (city) {
                    document.getElementById('cityInput').value = city;
                    searchHotels(city);
                    speakResponse(`Searching for hotels in ${city}`);
                }
            }
            // City search commands
            else if (command.includes('casablanca')) {
                searchCity('Casablanca');
                speakResponse('Searching hotels in Casablanca');
            } else if (command.includes('marrakech')) {
                searchCity('Marrakech');
                speakResponse('Searching hotels in Marrakech');
            } else if (command.includes('rabat')) {
                searchCity('Rabat');
                speakResponse('Searching hotels in Rabat');
            }
            // Help command
            else if (command.includes('help') || command.includes('what can you do')) {
                speakResponse('I can help you scroll, search for hotels, navigate to different pages, and search specific cities. Just tell me what you want to do.');
            }
            // Deactivation command
            else if (command.includes('deactivate') || command.includes('stop listening')) {
                stopAgentListening();
            }
            // Unknown command
            else {
                speakResponse('Sorry, I did not understand that command. Say help to know what I can do.');
            }
        }

        function speakResponse(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'en-US';
                speechSynthesis.speak(utterance);
            }
        }

        // Event Listeners for the voice agent
        voiceAgentBtn.addEventListener('click', () => {
            if (!isAgentListening) {
                startAgentListening();
            } else {
                stopAgentListening();
            }
        });

        sendCommandBtn.addEventListener('click', () => {
            const command = commandInput.value.toLowerCase();
            if (command) {
                handleAgentCommand(command);
                commandInput.value = '';
            }
        });

        commandInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const command = commandInput.value.toLowerCase();
                if (command) {
                    handleAgentCommand(command);
                    commandInput.value = '';
                }
            }
        });

        // Initialize agent on page load and check if it was active on previous page
        document.addEventListener('DOMContentLoaded', () => {
            initAgentRecognition();
            if (localStorage.getItem('agentActive') === 'true') {
                startAgentListening();
            }
        });
    </script>
</body>
</html> 