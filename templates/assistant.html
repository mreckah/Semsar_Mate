<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Semsar Assistant - Your AI Travel Companion</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --navy: #0A2463;
            --gold: #D4AF37;
            --white: #FFFFFF;
            --light-gold: rgba(212, 175, 55, 0.1);
            --navy-light: rgba(10, 36, 99, 0.1);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .navbar {
            background: var(--navy);
            padding: 1rem 0;
            box-shadow: 0 2px 10px rgba(10, 36, 99, 0.2);
        }

        .navbar-brand {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--gold) !important;
        }

        .nav-link {
            color: var(--white) !important;
            transition: all 0.3s ease;
        }

        .nav-link:hover {
            color: var(--gold) !important;
            transform: translateY(-2px);
        }

        .assistant-container {
            flex: 1;
            display: flex;
            padding: 2rem;
            gap: 2rem;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        .chat-sidebar {
            width: 300px;
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            height: fit-content;
        }

        .chat-main {
            flex: 1;
            background: white;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            height: calc(100vh - 200px); /* Fixed height for the chat container */
        }

        .chat-header {
            padding: 1.5rem;
            background: var(--navy);
            color: white;
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-shrink: 0; /* Prevent header from shrinking */
        }

        .chat-header i {
            font-size: 1.5rem;
            color: var(--gold);
        }

        .chat-messages {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            height: 100%; /* Take full height of parent */
            scrollbar-width: thin; /* For Firefox */
            scrollbar-color: var(--navy) var(--light-gold); /* For Firefox */
        }

        /* Custom scrollbar for Webkit browsers */
        .chat-messages::-webkit-scrollbar {
            width: 8px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: var(--light-gold);
            border-radius: 4px;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: var(--navy);
            border-radius: 4px;
        }

        .chat-messages::-webkit-scrollbar-thumb:hover {
            background: var(--gold);
        }

        .message {
            display: flex;
            gap: 1rem;
            max-width: 80%;
        }

        .message.user {
            margin-left: auto;
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--navy);
            color: var(--gold);
            font-size: 1.2rem;
        }

        .message-content {
            padding: 1rem;
            border-radius: 15px;
            background: var(--navy-light);
            color: var(--navy);
        }

        .message.user .message-content {
            background: var(--navy);
            color: white;
        }

        .chat-input {
            padding: 1.5rem;
            background: white;
            border-top: 1px solid #eee;
            display: flex;
            gap: 1rem;
            flex-shrink: 0; /* Prevent input from shrinking */
        }

        .chat-input input {
            flex: 1;
            padding: 0.75rem 1rem;
            border: 1px solid #ddd;
            border-radius: 25px;
            outline: none;
            transition: all 0.3s ease;
        }

        .chat-input input:focus {
            border-color: var(--navy);
            box-shadow: 0 0 0 2px var(--navy-light);
        }

        .chat-input button {
            background: var(--navy);
            color: white;
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .chat-input button:hover {
            background: var(--gold);
            transform: scale(1.05);
        }

        .chat-input button.recording {
            background: #dc3545;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
            100% {
                transform: scale(1);
            }
        }

        .voice-status {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--navy);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            display: none;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .voice-status.active {
            display: flex;
        }

        .voice-status i {
            color: var(--gold);
        }

        .suggestion-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .suggestion-chip {
            background: var(--light-gold);
            color: var(--navy);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }

        .suggestion-chip:hover {
            background: var(--navy);
            color: white;
            transform: translateY(-2px);
        }

        .sidebar-section {
            margin-bottom: 2rem;
        }

        .sidebar-section h3 {
            color: var(--navy);
            font-size: 1.2rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .sidebar-section h3 i {
            color: var(--gold);
        }

        @media (max-width: 768px) {
            .assistant-container {
                flex-direction: column;
                padding: 1rem;
                height: calc(100vh - 100px);
            }

            .chat-main {
                height: calc(100vh - 300px);
            }

            .chat-sidebar {
                width: 100%;
            }

            .message {
                max-width: 90%;
            }
        }

        /* Add styles for the speak button */
        .speak-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--navy);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .speak-button:hover {
            transform: scale(1.1);
            background: var(--gold);
        }

        .speak-button i {
            font-size: 1.2rem;
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-hotel me-2"></i>Semsar Mate
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" title="Toggle navigation menu">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/signin">
                            <i class="fas fa-sign-in-alt me-1"></i>Sign In
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/signup">
                            <i class="fas fa-user-plus me-1"></i>Sign Up
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Assistant Interface -->
    <div class="assistant-container">
        <!-- Sidebar -->
        <div class="chat-sidebar">
            <div class="sidebar-section">
                <h3><i class="fas fa-lightbulb"></i>Quick Tips</h3>
                <p>Ask me about:</p>
                <div class="suggestion-chips">
                    <div class="suggestion-chip" onclick="askQuestion('What are the best hotels in Marrakech?')">Best Hotels</div>
                    <div class="suggestion-chip" onclick="askQuestion('What are the top attractions in Casablanca?')">Attractions</div>
                    <div class="suggestion-chip" onclick="askQuestion('What is the best time to visit Morocco?')">Best Time</div>
                    <div class="suggestion-chip" onclick="askQuestion('What are the local customs I should know?')">Local Customs</div>
                </div>
            </div>
            <div class="sidebar-section">
                <h3><i class="fas fa-info-circle"></i>About Assistant</h3>
                <p>I'm your AI travel companion, here to help you plan your perfect stay in Morocco. I can assist with:</p>
                <ul>
                    <li>Hotel recommendations</li>
                    <li>Travel planning</li>
                    <li>Local insights</li>
                    <li>Cultural information</li>
                </ul>
            </div>
        </div>

        <!-- Main Chat Area -->
        <div class="chat-main">
            <div class="chat-header">
                <i class="fas fa-robot"></i>
                <h2 class="mb-0">Semsar Assistant</h2>
            </div>
            <div class="chat-messages" id="chat-messages">
                <div class="message">
                    <div class="message-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="message-content">
                        Hello! I'm Semsar Assistant, your AI travel companion. How can I help you plan your perfect stay in Morocco?
                    </div>
                </div>
            </div>
            <div class="chat-input">
                <input type="text" id="user-input" placeholder="Ask me anything about hotels and travel in Morocco..." onkeypress="handleKeyPress(event)">
                <button onclick="sendMessage()" title="Send message">
                    <i class="fas fa-paper-plane"></i>
                </button>
                <button id="voiceButton" onclick="toggleVoiceInput()" title="Start voice input">
                    <i class="fas fa-microphone"></i>
                </button>
                <div id="voiceStatus" class="voice-status">
                    <i class="fas fa-microphone"></i>
                    <span>Listening...</span>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Configuration
        const OPENROUTER_API_KEY = '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';
        const API_CONFIG = {
            model: 'anthropic/claude-3-haiku:beta',
            max_tokens: 300,
            system_prompt: 'You are a helpful travel assistant for Semsar Mate, a hotel booking platform in Morocco. Keep responses concise and focused on hotel recommendations and travel advice. IMPORTANT: You must respond in the same language as the user\'s input. If the user speaks in French, respond in French. If the user speaks in English, respond in English. Never mix languages in your response.'
        };

        // Language detection function
        function detectLanguage(text) {
            // Enhanced French language detection with more patterns
            const frenchPatterns = /\b(le|la|les|un|une|des|je|tu|il|elle|nous|vous|ils|elles|bonjour|merci|oui|non|s'il vous plaît|comment|où|quand|pourquoi|combien|quel|quelle|quels|quelles|bien|très|aussi|encore|toujours|jamais|maintenant|aujourd'hui|demain|hier|hôtel|chambre|prix|réservation|recherche|ville|voyage|vacances|visite|touriste|restaurant|plage|montagne|désert|culture|histoire|art|musée|monument|transport|bus|train|avion|voiture|taxi|métro|station|aéroport|gare|port|plage|mer|océan|rivière|lac|parc|jardin|place|rue|avenue|boulevard|quartier|centre|ville|pays|région|province|département|arrondissement|code postal|adresse|téléphone|email|internet|site web|application|service|client|accueil|réception|concierge|chambre|suite|appartement|villa|maison|restaurant|bar|piscine|spa|gym|salle|confort|luxe|standard|économique|prix|tarif|réduction|promotion|offre|spécial|saison|haute|basse|moyenne|saison|été|hiver|printemps|automne|janvier|février|mars|avril|mai|juin|juillet|août|septembre|octobre|novembre|décembre|lundi|mardi|mercredi|jeudi|vendredi|samedi|dimanche)\b/i;
            
            // Check for French-specific characters and patterns
            const frenchChars = /[éèêëàâçîïôöûüùœæ]/i;
            
            // If text contains French characters or matches French patterns, it's French
            if (frenchPatterns.test(text) || frenchChars.test(text)) {
                console.log('Detected French language');
                return 'fr-FR';
            }
            
            console.log('Detected English language');
            return 'en-US';
        }

        // Speech Synthesis
        let speechSynthesis = window.speechSynthesis;
        let speaking = false;
        let currentUtterance = null;
        let currentLanguage = 'en-US';

        function speakText(text, language) {
            if (speaking) {
                speechSynthesis.cancel();
            }

            const utterance = new SpeechSynthesisUtterance(text);
            utterance.rate = 1.0;
            utterance.pitch = 1.0;
            utterance.volume = 1.0;

            // Get available voices and set a preferred voice for the detected language
            const voices = speechSynthesis.getVoices();
            let preferredVoice = null;

            if (language === 'fr-FR') {
                // Try to find a French voice
                preferredVoice = voices.find(voice => 
                    voice.lang === 'fr-FR' || 
                    voice.lang === 'fr-CA' || 
                    voice.name.includes('French')
                );
            } else {
                // Try to find an English voice
                preferredVoice = voices.find(voice => 
                    voice.lang === 'en-US' || 
                    voice.lang === 'en-GB' || 
                    voice.name.includes('English')
                );
            }

            if (preferredVoice) {
                console.log('Using voice:', preferredVoice.name, 'for language:', language);
                utterance.voice = preferredVoice;
            } else {
                console.log('No specific voice found for language:', language);
            }

            utterance.onstart = () => {
                speaking = true;
                document.getElementById('speakButton').innerHTML = '<i class="fas fa-stop"></i>';
            };

            utterance.onend = () => {
                speaking = false;
                document.getElementById('speakButton').innerHTML = '<i class="fas fa-volume-up"></i>';
            };

            currentUtterance = utterance;
            speechSynthesis.speak(utterance);
        }

        function toggleSpeech() {
            const button = document.getElementById('speakButton');
            if (speaking) {
                speechSynthesis.cancel();
                speaking = false;
                button.innerHTML = '<i class="fas fa-volume-up"></i>';
            } else {
                const lastMessage = document.querySelector('.message.assistant:last-child .message-content');
                if (lastMessage) {
                    speakText(lastMessage.textContent, currentLanguage);
                }
            }
        }

        // Event Handlers
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        function askQuestion(question) {
            document.getElementById('user-input').value = question;
            sendMessage();
        }

        // Message Handling
        async function sendMessage() {
            const input = document.getElementById('user-input');
            const message = input.value.trim();
            
            if (!message) return;

            // Detect language from user input
            currentLanguage = detectLanguage(message);
            console.log('Detected language:', currentLanguage);
            
            addMessage(message, 'user');
            input.value = '';

            try {
                const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${OPENROUTER_API_KEY}`,
                        'HTTP-Referer': window.location.origin,
                        'X-Title': 'Semsar Mate'
                    },
                    body: JSON.stringify({
                        model: API_CONFIG.model,
                        max_tokens: API_CONFIG.max_tokens,
                        messages: [
                            {
                                role: 'system',
                                content: API_CONFIG.system_prompt + (currentLanguage === 'fr-FR' ? 
                                    ' Répondez en français.' : 
                                    ' Respond in English.')
                            },
                            {
                                role: 'user',
                                content: message
                            }
                        ]
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    console.error('API Error:', errorData);
                    throw new Error(`API Error: ${errorData.error?.message || response.statusText}`);
                }

                const data = await response.json();
                if (!data.choices || !data.choices[0]?.message?.content) {
                    console.error('Invalid API Response:', data);
                    throw new Error('Invalid response format from API');
                }

                const aiResponse = data.choices[0].message.content;
                addMessage(aiResponse, 'assistant');
                
                // Auto-speak the response in the detected language
                speakText(aiResponse, currentLanguage);
            } catch (error) {
                console.error('Detailed Error:', error);
                const errorMessage = currentLanguage === 'fr-FR' 
                    ? "Je m'excuse, mais j'ai des difficultés à me connecter à mon cerveau en ce moment. Veuillez réessayer dans un instant."
                    : "I apologize, but I'm having trouble connecting to my brain right now. Please try again in a moment.";
                addMessage(errorMessage, 'assistant');
            }
        }

        function addMessage(content, sender) {
            const chatMessages = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            const avatar = sender === 'user' ? 
                '<div class="message-avatar"><i class="fas fa-user"></i></div>' :
                '<div class="message-avatar"><i class="fas fa-robot"></i></div>';

            messageDiv.innerHTML = `
                ${avatar}
                <div class="message-content">
                    ${content}
                </div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Initialize speech synthesis voices
        function initVoices() {
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = () => {
                    const voices = speechSynthesis.getVoices();
                    console.log('Available voices:', voices.map(v => `${v.name} (${v.lang})`));
                };
            }
        }

        // Speech Recognition
        let recognition = null;
        let isRecording = false;
        let retryCount = 0;
        const MAX_RETRIES = 3;

        function initSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                // Use the appropriate SpeechRecognition constructor
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                
                recognition.continuous = false;
                recognition.interimResults = true; // Enable interim results
                recognition.maxAlternatives = 1;
                recognition.lang = currentLanguage;

                recognition.onstart = () => {
                    console.log('Speech recognition started');
                    isRecording = true;
                    retryCount = 0;
                    document.getElementById('voiceButton').classList.add('recording');
                    document.getElementById('voiceStatus').classList.add('active');
                    // Stop any ongoing speech when starting recording
                    if (speaking) {
                        speechSynthesis.cancel();
                        speaking = false;
                        document.getElementById('speakButton').innerHTML = '<i class="fas fa-volume-up"></i>';
                    }
                };

                recognition.onend = () => {
                    console.log('Speech recognition ended');
                    isRecording = false;
                    document.getElementById('voiceButton').classList.remove('recording');
                    document.getElementById('voiceStatus').classList.remove('active');
                };

                recognition.onresult = (event) => {
                    console.log('Speech recognition result received');
                    // Get the most recent result
                    const result = event.results[event.results.length - 1];
                    const transcript = result[0].transcript;
                    
                    // Only process if the result is final
                    if (result.isFinal) {
                        console.log('Final transcript:', transcript);
                        document.getElementById('user-input').value = transcript;
                        // Update language based on the transcript
                        currentLanguage = detectLanguage(transcript);
                        sendMessage();
                    } else {
                        console.log('Interim transcript:', transcript);
                    }
                };

                recognition.onerror = (event) => {
                    console.error('Speech recognition error:', event.error);
                    isRecording = false;
                    document.getElementById('voiceButton').classList.remove('recording');
                    document.getElementById('voiceStatus').classList.remove('active');
                    
                    let errorMessage = currentLanguage === 'fr-FR' 
                        ? 'Erreur avec la saisie vocale. '
                        : 'Error with voice input. ';
                    
                    switch(event.error) {
                        case 'no-speech':
                            if (retryCount < MAX_RETRIES) {
                                retryCount++;
                                errorMessage = currentLanguage === 'fr-FR'
                                    ? `Aucune parole détectée. Nouvelle tentative (${retryCount}/${MAX_RETRIES})...`
                                    : `No speech detected. Retrying (${retryCount}/${MAX_RETRIES})...`;
                                setTimeout(() => {
                                    try {
                                        recognition.start();
                                    } catch (e) {
                                        console.error('Retry failed:', e);
                                    }
                                }, 1000);
                            } else {
                                errorMessage += currentLanguage === 'fr-FR'
                                    ? 'Aucune parole n\'a été détectée. Veuillez parler plus fort ou vérifier votre microphone.'
                                    : 'No speech was detected. Please speak louder or check your microphone.';
                            }
                            break;
                        case 'audio-capture':
                            errorMessage += currentLanguage === 'fr-FR'
                                ? 'Aucun microphone n\'a été trouvé. Veuillez vérifier vos paramètres de microphone.'
                                : 'No microphone was found. Please check your microphone settings.';
                            break;
                        case 'not-allowed':
                            errorMessage += currentLanguage === 'fr-FR'
                                ? 'L\'accès au microphone a été refusé. Veuillez autoriser l\'accès au microphone dans les paramètres de votre navigateur.'
                                : 'Microphone access was denied. Please allow microphone access in your browser settings.';
                            break;
                        case 'network':
                            if (retryCount < MAX_RETRIES) {
                                retryCount++;
                                errorMessage = currentLanguage === 'fr-FR'
                                    ? `Tentative de reconnexion (${retryCount}/${MAX_RETRIES})...`
                                    : `Attempting to reconnect (${retryCount}/${MAX_RETRIES})...`;
                                setTimeout(() => {
                                    try {
                                        recognition.start();
                                    } catch (e) {
                                        console.error('Retry failed:', e);
                                    }
                                }, 1000);
                            } else {
                                errorMessage += currentLanguage === 'fr-FR'
                                    ? 'Erreur réseau persistante. Veuillez vérifier votre connexion internet et réessayer.'
                                    : 'Persistent network error. Please check your internet connection and try again.';
                            }
                            break;
                        default:
                            errorMessage += currentLanguage === 'fr-FR'
                                ? 'Veuillez réessayer. Si le problème persiste, essayez de rafraîchir la page.'
                                : 'Please try again. If the problem persists, try refreshing the page.';
                    }
                    addMessage(errorMessage, 'assistant');
                };

                // Add timeout to prevent hanging
                recognition.onspeechend = () => {
                    console.log('Speech ended');
                    if (isRecording) {
                        recognition.stop();
                    }
                };

                recognition.onaudiostart = () => {
                    console.log('Audio capturing started');
                };

                recognition.onaudioend = () => {
                    console.log('Audio capturing ended');
                };

                recognition.onsoundstart = () => {
                    console.log('Sound detected');
                };

                recognition.onsoundend = () => {
                    console.log('Sound ended');
                };

            } else {
                console.error('Speech recognition not supported in this browser');
                const errorMessage = currentLanguage === 'fr-FR'
                    ? 'La reconnaissance vocale n\'est pas prise en charge dans votre navigateur. Veuillez utiliser Chrome, Edge ou Safari.'
                    : 'Speech recognition is not supported in your browser. Please use Chrome, Edge, or Safari.';
                addMessage(errorMessage, 'assistant');
                document.getElementById('voiceButton').style.display = 'none';
            }
        }

        function toggleVoiceInput() {
            if (!recognition) {
                initSpeechRecognition();
            }

            if (isRecording) {
                recognition.stop();
            } else {
                // Stop any ongoing speech before starting recording
                if (speaking) {
                    speechSynthesis.cancel();
                    speaking = false;
                    document.getElementById('speakButton').innerHTML = '<i class="fas fa-volume-up"></i>';
                }

                // Check internet connection before starting
                if (!navigator.onLine) {
                    const errorMessage = currentLanguage === 'fr-FR'
                        ? 'Pas de connexion internet. Veuillez vérifier votre connexion et réessayer.'
                        : 'No internet connection. Please check your connection and try again.';
                    addMessage(errorMessage, 'assistant');
                    return;
                }

                try {
                    // Reset retry count
                    retryCount = 0;
                    // Set the recognition language based on the current language
                    recognition.lang = currentLanguage;
                    recognition.start();
                    console.log('Starting speech recognition with language:', currentLanguage);
                } catch (error) {
                    console.error('Error starting speech recognition:', error);
                    const errorMessage = currentLanguage === 'fr-FR'
                        ? 'Impossible de démarrer la reconnaissance vocale. Veuillez vérifier les permissions du microphone.'
                        : 'Unable to start speech recognition. Please check microphone permissions.';
                    addMessage(errorMessage, 'assistant');
                }
            }
        }

        // Add online/offline event listeners
        window.addEventListener('online', () => {
            console.log('Internet connection restored');
            const message = currentLanguage === 'fr-FR'
                ? 'Connexion internet rétablie. Vous pouvez maintenant utiliser la reconnaissance vocale.'
                : 'Internet connection restored. You can now use voice recognition.';
            addMessage(message, 'assistant');
        });

        window.addEventListener('offline', () => {
            console.log('Internet connection lost');
            const message = currentLanguage === 'fr-FR'
                ? 'Connexion internet perdue. La reconnaissance vocale n\'est pas disponible.'
                : 'Internet connection lost. Voice recognition is not available.';
            addMessage(message, 'assistant');
        });

        // Initialize voices when the page loads
        window.addEventListener('load', () => {
            console.log('Page loaded, initializing voices...');
            initVoices();
            initSpeechRecognition();
        });
    </script>

    <!-- Add the speak button to the HTML -->
    <button id="speakButton" class="speak-button" onclick="toggleSpeech()" title="Toggle speech">
        <i class="fas fa-volume-up"></i>
    </button>
</body>
</html> 